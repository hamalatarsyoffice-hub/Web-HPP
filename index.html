<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitung Margin Barang</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ef 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1100px;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.07);
            padding: 2rem 2.5rem 2.5rem 2.5rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        @media (max-width: 1200px) {
            .container {
                max-width: 900px;
                padding: 1.5rem 1rem 2rem 1rem;
            }
        }
        h4 {
            font-weight: 700;
            color: #2d3748;
            letter-spacing: 0.5px;
        }
        .table {
            background: #f9fafb;
            border-radius: 10px;
            overflow: hidden;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .table th {
            background: #e9ecef;
            color: #495057;
            font-weight: 600;
        }
        .form-control, .form-control:focus {
            background: #f4f6fb;
            border: 1px solid #d1d5db;
            box-shadow: none;
            font-size: 1rem;
        }
        .btn-primary {
            background: #2563eb;
            border: none;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .btn-primary:hover {
            background: #1d4ed8;
        }
        .btn-danger {
            background: #ef4444;
            border: none;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .card {
            background: #f1f5f9;
            border-radius: 14px;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .fw-bold {
            color: #2563eb;
            font-size: 1.15rem;
        }
        @media (max-width: 600px) {
            .container {
                max-width: 100vw;
                padding: 1rem 0.2rem 1.5rem 0.2rem;
            }
            h4 {
                font-size: 1.2rem;
            }
            .table th, .table td {
                font-size: 0.95rem;
                padding: 0.4rem 0.3rem;
            }
            .card {
                padding: 1rem 0.7rem;
            }
        }
        input[type="number"], input[type="text"] {
            min-width: 80px;
        }
        table input {
            text-align: right;
        }
        .table-responsive {
            border-radius: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body class="p-3">

<div class="container shadow-lg">
    <h4 class="mb-4 text-center">Margin Calculator</h4>
    <div class="table-responsive mb-3">
        <table class="table table-bordered align-middle mb-0" id="barangTable">
            <thead class="table-light">
                <tr>
                    <th style="width: 36px;">No</th>
                    <th>Item</th>
                    <th style="width: 70px;">QTY</th>
                    <th style="width: 120px;">Harga Beli Satuan</th>
                    <th style="width: 130px;">Total Harga Beli</th>
                    <th style="width: 120px;">Harga Jual Satuan</th>
                    <th style="width: 130px;">Total Harga Jual</th>
                    <th style="width: 50px;">Del</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="no">1</td>
                    <td><input type="text" class="form-control nama" placeholder="Item"></td>
                    <td><input type="number" class="form-control qty" min="0" placeholder="0"></td>
                    <td><input type="number" class="form-control beli" min="0" placeholder="0"></td>
                    <td><input type="text" class="form-control totalBeli" readonly placeholder="Rp 0"></td>
                    <td><input type="number" class="form-control jual" min="0" placeholder="0"></td>
                    <td><input type="text" class="form-control totalJual" readonly placeholder="Rp 0"></td>
                    <td class="text-center"><button class="btn btn-danger btn-sm hapus" title="Hapus Baris"><i class="bi bi-x-lg"></i></button></td>
                </tr>
            </tbody>
        </table>
    </div>
    <button id="tambahBaris" class="btn btn-primary btn-sm mb-3 w-100"><i class="bi bi-plus-lg"></i> Tambah Baris</button>

    <div class="card p-3 mt-2">
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">Total Beli:</div>
            <div class="col-6 col-md-8"><span id="grandTotalBeli">Rp 0</span></div>
        </div>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">Total Jual:</div>
            <div class="col-6 col-md-8"><span id="grandTotalJual">Rp 0</span></div>
        </div>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">Margin Kotor:</div>
            <div class="col-6 col-md-8"><span id="marginKotor">Rp 0</span></div>
        </div>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">Selisih PPN:</div>
            <div class="col-6 col-md-8"><span id="selisihPPN">Rp 0</span></div>
        </div>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">PPH:</div>
            <div class="col-6 col-md-8"><span id="pph">Rp 0</span></div>
        </div>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">Cargo:</div>
            <div class="col-6 col-md-8"><input type="number" id="kargo" class="form-control form-control-sm" value="0"></div>
        </div>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-4">Lain-lain:</div>
            <div class="col-6 col-md-8"><input type="number" id="lainlain" class="form-control form-control-sm" value="0"></div>
        </div>
        <div class="row g-2 align-items-center mt-3">
            <div class="col-12 fw-bold">Margin Bersih: <span id="marginBersih">Rp 0</span></div>
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<script>
function formatRupiah(angka) {
    return "Rp " + angka.toLocaleString('id-ID');
}

function hitungTotal() {
    let totalBeli = 0, totalJual = 0;

    $("#barangTable tbody tr").each(function(){
        let qty = parseFloat($(this).find(".qty").val()) || 0;
        let beli = parseFloat($(this).find(".beli").val()) || 0;
        let jual = parseFloat($(this).find(".jual").val()) || 0;

        let totalBeliPerItem = qty * beli;
        let totalJualPerItem = qty * jual;

        $(this).find(".totalBeli").val(formatRupiah(totalBeliPerItem));
        $(this).find(".totalJual").val(formatRupiah(totalJualPerItem));

        totalBeli += totalBeliPerItem;
        totalJual += totalJualPerItem;
    });

    let marginKotor = totalJual - totalBeli;
    let selisihPPN = (totalJual * 0.11) - (totalBeli * 0.11);
    let pph = ((totalJual * 100 / 111) * 0.015);

    let kargo = parseFloat($("#kargo").val()) || 0;
    let lain = parseFloat($("#lainlain").val()) || 0;

    let marginBersih = marginKotor - (selisihPPN + pph + kargo + lain);

    $("#grandTotalBeli").text(formatRupiah(totalBeli));
    $("#grandTotalJual").text(formatRupiah(totalJual));
    $("#marginKotor").text(formatRupiah(marginKotor));
    $("#selisihPPN").text(formatRupiah(selisihPPN));
    $("#pph").text(formatRupiah(pph));
    $("#marginBersih").text(formatRupiah(marginBersih));
}

$(document).on("input", ".qty, .beli, .jual, #kargo, #lainlain", hitungTotal);

$("#tambahBaris").click(function(){
    let no = $("#barangTable tbody tr").length + 1;
    let row = `
        <tr>
            <td class="no">${no}</td>
            <td><input type="text" class="form-control nama"></td>
            <td><input type="number" class="form-control qty" min="0"></td>
            <td><input type="number" class="form-control beli" min="0"></td>
            <td><input type="text" class="form-control totalBeli" readonly></td>
            <td><input type="number" class="form-control jual" min="0"></td>
            <td><input type="text" class="form-control totalJual" readonly></td>
            <td><button class="btn btn-danger btn-sm hapus">X</button></td>
        </tr>
    `;
    $("#barangTable tbody").append(row);
});

$(document).on("click", ".hapus", function(){
    $(this).closest("tr").remove();
    $("#barangTable tbody tr").each(function(i){
        $(this).find(".no").text(i+1);
    });
    hitungTotal();
});
</script>

</body>
</html>
